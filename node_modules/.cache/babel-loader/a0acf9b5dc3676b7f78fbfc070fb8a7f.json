{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.findPlaceholder = void 0;\n\nconst prosemirror_state_1 = require(\"prosemirror-state\");\n\nconst prosemirror_view_1 = require(\"prosemirror-view\");\n\nconst uploadPlaceholder = new prosemirror_state_1.Plugin({\n  state: {\n    init() {\n      return prosemirror_view_1.DecorationSet.empty;\n    },\n\n    apply(tr, set) {\n      var _a;\n\n      set = set.map(tr.mapping, tr.doc);\n      const action = tr.getMeta(this);\n\n      if (action === null || action === void 0 ? void 0 : action.add) {\n        if (action.add.replaceExisting) {\n          const $pos = tr.doc.resolve(action.add.pos);\n\n          if (((_a = $pos.nodeAfter) === null || _a === void 0 ? void 0 : _a.type.name) === \"image\") {\n            const deco = prosemirror_view_1.Decoration.node($pos.pos, $pos.pos + $pos.nodeAfter.nodeSize, {\n              class: \"image-replacement-uploading\"\n            }, {\n              id: action.add.id\n            });\n            set = set.add(tr.doc, [deco]);\n          }\n        } else {\n          const element = document.createElement(\"div\");\n          element.className = \"image placeholder\";\n          const img = document.createElement(\"img\");\n          img.src = URL.createObjectURL(action.add.file);\n          element.appendChild(img);\n          const deco = prosemirror_view_1.Decoration.widget(action.add.pos, element, {\n            id: action.add.id\n          });\n          set = set.add(tr.doc, [deco]);\n        }\n      }\n\n      if (action === null || action === void 0 ? void 0 : action.remove) {\n        set = set.remove(set.find(null, null, spec => spec.id === action.remove.id));\n      }\n\n      return set;\n    }\n\n  },\n  props: {\n    decorations(state) {\n      return this.getState(state);\n    }\n\n  }\n});\nexports.default = uploadPlaceholder;\n\nfunction findPlaceholder(state, id) {\n  const decos = uploadPlaceholder.getState(state);\n  const found = decos.find(null, null, spec => spec.id === id);\n  return found.length ? [found[0].from, found[0].to] : null;\n}\n\nexports.findPlaceholder = findPlaceholder;","map":{"version":3,"sources":["../../src/lib/uploadPlaceholder.ts"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.findPlaceholder = void 0;\nconst prosemirror_state_1 = require(\"prosemirror-state\");\nconst prosemirror_view_1 = require(\"prosemirror-view\");\nconst uploadPlaceholder = new prosemirror_state_1.Plugin({\n    state: {\n        init() {\n            return prosemirror_view_1.DecorationSet.empty;\n        },\n        apply(tr, set) {\n            var _a;\n            set = set.map(tr.mapping, tr.doc);\n            const action = tr.getMeta(this);\n            if (action === null || action === void 0 ? void 0 : action.add) {\n                if (action.add.replaceExisting) {\n                    const $pos = tr.doc.resolve(action.add.pos);\n                    if (((_a = $pos.nodeAfter) === null || _a === void 0 ? void 0 : _a.type.name) === \"image\") {\n                        const deco = prosemirror_view_1.Decoration.node($pos.pos, $pos.pos + $pos.nodeAfter.nodeSize, {\n                            class: \"image-replacement-uploading\",\n                        }, {\n                            id: action.add.id,\n                        });\n                        set = set.add(tr.doc, [deco]);\n                    }\n                }\n                else {\n                    const element = document.createElement(\"div\");\n                    element.className = \"image placeholder\";\n                    const img = document.createElement(\"img\");\n                    img.src = URL.createObjectURL(action.add.file);\n                    element.appendChild(img);\n                    const deco = prosemirror_view_1.Decoration.widget(action.add.pos, element, {\n                        id: action.add.id,\n                    });\n                    set = set.add(tr.doc, [deco]);\n                }\n            }\n            if (action === null || action === void 0 ? void 0 : action.remove) {\n                set = set.remove(set.find(null, null, spec => spec.id === action.remove.id));\n            }\n            return set;\n        },\n    },\n    props: {\n        decorations(state) {\n            return this.getState(state);\n        },\n    },\n});\nexports.default = uploadPlaceholder;\nfunction findPlaceholder(state, id) {\n    const decos = uploadPlaceholder.getState(state);\n    const found = decos.find(null, null, spec => spec.id === id);\n    return found.length ? [found[0].from, found[0].to] : null;\n}\nexports.findPlaceholder = findPlaceholder;\n"]},"metadata":{},"sourceType":"script"}