{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst prosemirror_state_1 = require(\"prosemirror-state\");\n\nconst copy_to_clipboard_1 = __importDefault(require(\"copy-to-clipboard\"));\n\nconst prosemirror_view_1 = require(\"prosemirror-view\");\n\nconst prosemirror_inputrules_1 = require(\"prosemirror-inputrules\");\n\nconst backspaceToParagraph_1 = __importDefault(require(\"../commands/backspaceToParagraph\"));\n\nconst toggleBlockType_1 = __importDefault(require(\"../commands/toggleBlockType\"));\n\nconst splitHeading_1 = __importDefault(require(\"../commands/splitHeading\"));\n\nconst headingToSlug_1 = __importStar(require(\"../lib/headingToSlug\"));\n\nconst Node_1 = __importDefault(require(\"./Node\"));\n\nconst types_1 = require(\"../types\");\n\nclass Heading extends Node_1.default {\n  constructor() {\n    super(...arguments);\n    this.className = \"heading-name\";\n\n    this.handleFoldContent = event => {\n      event.preventDefault();\n      const {\n        view\n      } = this.editor;\n      const hadFocus = view.hasFocus();\n      const {\n        tr\n      } = view.state;\n      const {\n        top,\n        left\n      } = event.target.getBoundingClientRect();\n      const result = view.posAtCoords({\n        top,\n        left\n      });\n\n      if (result) {\n        const node = view.state.doc.nodeAt(result.inside);\n\n        if (node) {\n          const endOfHeadingPos = result.inside + node.nodeSize;\n          const $pos = view.state.doc.resolve(endOfHeadingPos);\n          const collapsed = !node.attrs.collapsed;\n\n          if (collapsed && view.state.selection.to > endOfHeadingPos) {\n            tr.setSelection(prosemirror_state_1.Selection.near($pos, -1));\n          }\n\n          const transaction = tr.setNodeMarkup(result.inside, undefined, Object.assign(Object.assign({}, node.attrs), {\n            collapsed\n          }));\n          const persistKey = headingToSlug_1.headingToPersistenceKey(node, this.editor.props.id);\n\n          if (collapsed) {\n            localStorage === null || localStorage === void 0 ? void 0 : localStorage.setItem(persistKey, \"collapsed\");\n          } else {\n            localStorage === null || localStorage === void 0 ? void 0 : localStorage.removeItem(persistKey);\n          }\n\n          view.dispatch(transaction);\n\n          if (hadFocus) {\n            view.focus();\n          }\n        }\n      }\n    };\n\n    this.handleCopyLink = event => {\n      const anchor = event.currentTarget.parentNode.parentNode.previousSibling;\n\n      if (!anchor.className.includes(this.className)) {\n        throw new Error(\"Did not find anchor as previous sibling of heading\");\n      }\n\n      const hash = `#${anchor.id}`;\n      const urlWithoutHash = window.location.href.split(\"#\")[0];\n      copy_to_clipboard_1.default(urlWithoutHash + hash);\n\n      if (this.options.onShowToast) {\n        this.options.onShowToast(this.options.dictionary.linkCopied, types_1.ToastType.Info);\n      }\n    };\n  }\n\n  get name() {\n    return \"heading\";\n  }\n\n  get defaultOptions() {\n    return {\n      levels: [1, 2, 3, 4],\n      collapsed: undefined\n    };\n  }\n\n  get schema() {\n    return {\n      attrs: {\n        level: {\n          default: 1\n        },\n        collapsed: {\n          default: undefined\n        }\n      },\n      content: \"inline*\",\n      group: \"block\",\n      defining: true,\n      draggable: false,\n      parseDOM: this.options.levels.map(level => ({\n        tag: `h${level}`,\n        attrs: {\n          level\n        },\n        contentElement: \".heading-content\"\n      })),\n      toDOM: node => {\n        const anchor = document.createElement(\"button\");\n        anchor.innerText = \"#\";\n        anchor.type = \"button\";\n        anchor.className = \"heading-anchor\";\n        anchor.addEventListener(\"click\", event => this.handleCopyLink(event));\n        const fold = document.createElement(\"button\");\n        fold.innerText = \"\";\n        fold.innerHTML = '<svg fill=\"currentColor\" width=\"12\" height=\"24\" viewBox=\"6 0 12 24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.23823905,10.6097108 L11.207376,14.4695888 L11.207376,14.4695888 C11.54411,14.907343 12.1719566,14.989236 12.6097108,14.652502 C12.6783439,14.5997073 12.7398293,14.538222 12.792624,14.4695888 L15.761761,10.6097108 L15.761761,10.6097108 C16.0984949,10.1719566 16.0166019,9.54410997 15.5788477,9.20737601 C15.4040391,9.07290785 15.1896811,9 14.969137,9 L9.03086304,9 L9.03086304,9 C8.47857829,9 8.03086304,9.44771525 8.03086304,10 C8.03086304,10.2205442 8.10377089,10.4349022 8.23823905,10.6097108 Z\" /></svg>';\n        fold.type = \"button\";\n        fold.className = `heading-fold ${node.attrs.collapsed ? \"collapsed\" : \"\"}`;\n        fold.addEventListener(\"mousedown\", event => this.handleFoldContent(event));\n        return [`h${node.attrs.level + (this.options.offset || 0)}`, [\"span\", {\n          contentEditable: false,\n          class: `heading-actions ${node.attrs.collapsed ? \"collapsed\" : \"\"}`\n        }, anchor, fold], [\"span\", {\n          class: \"heading-content\"\n        }, 0]];\n      }\n    };\n  }\n\n  toMarkdown(state, node) {\n    state.write(state.repeat(\"#\", node.attrs.level) + \" \");\n    state.renderInline(node);\n    state.closeBlock(node);\n  }\n\n  parseMarkdown() {\n    return {\n      block: \"heading\",\n      getAttrs: token => ({\n        level: +token.tag.slice(1)\n      })\n    };\n  }\n\n  commands(_ref) {\n    let {\n      type,\n      schema\n    } = _ref;\n    return attrs => {\n      return toggleBlockType_1.default(type, schema.nodes.paragraph, attrs);\n    };\n  }\n\n  keys(_ref2) {\n    let {\n      type,\n      schema\n    } = _ref2;\n    const options = this.options.levels.reduce((items, level) => Object.assign(Object.assign({}, items), {\n      [`Shift-Ctrl-${level}`]: toggleBlockType_1.default(type, schema.nodes.paragraph, {\n        level\n      })\n    }), {});\n    return Object.assign(Object.assign({}, options), {\n      Backspace: backspaceToParagraph_1.default(type),\n      Enter: splitHeading_1.default(type)\n    });\n  }\n\n  get plugins() {\n    const getAnchors = doc => {\n      const decorations = [];\n      const previouslySeen = {};\n      doc.descendants((node, pos) => {\n        if (node.type.name !== this.name) return;\n        const slug = headingToSlug_1.default(node);\n        let id = slug;\n\n        if (previouslySeen[slug] > 0) {\n          id = headingToSlug_1.default(node, previouslySeen[slug]);\n        }\n\n        previouslySeen[slug] = previouslySeen[slug] !== undefined ? previouslySeen[slug] + 1 : 1;\n        decorations.push(prosemirror_view_1.Decoration.widget(pos, () => {\n          const anchor = document.createElement(\"a\");\n          anchor.id = id;\n          anchor.className = this.className;\n          return anchor;\n        }, {\n          side: -1,\n          key: id\n        }));\n      });\n      return prosemirror_view_1.DecorationSet.create(doc, decorations);\n    };\n\n    const plugin = new prosemirror_state_1.Plugin({\n      state: {\n        init: (config, state) => {\n          return getAnchors(state.doc);\n        },\n        apply: (tr, oldState) => {\n          return tr.docChanged ? getAnchors(tr.doc) : oldState;\n        }\n      },\n      props: {\n        decorations: state => plugin.getState(state)\n      }\n    });\n    return [plugin];\n  }\n\n  inputRules(_ref3) {\n    let {\n      type\n    } = _ref3;\n    return this.options.levels.map(level => prosemirror_inputrules_1.textblockTypeInputRule(new RegExp(`^(#{1,${level}})\\\\s$`), type, () => ({\n      level\n    })));\n  }\n\n}\n\nexports.default = Heading;","map":{"version":3,"sources":["../../src/nodes/Heading.ts"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst prosemirror_state_1 = require(\"prosemirror-state\");\nconst copy_to_clipboard_1 = __importDefault(require(\"copy-to-clipboard\"));\nconst prosemirror_view_1 = require(\"prosemirror-view\");\nconst prosemirror_inputrules_1 = require(\"prosemirror-inputrules\");\nconst backspaceToParagraph_1 = __importDefault(require(\"../commands/backspaceToParagraph\"));\nconst toggleBlockType_1 = __importDefault(require(\"../commands/toggleBlockType\"));\nconst splitHeading_1 = __importDefault(require(\"../commands/splitHeading\"));\nconst headingToSlug_1 = __importStar(require(\"../lib/headingToSlug\"));\nconst Node_1 = __importDefault(require(\"./Node\"));\nconst types_1 = require(\"../types\");\nclass Heading extends Node_1.default {\n    constructor() {\n        super(...arguments);\n        this.className = \"heading-name\";\n        this.handleFoldContent = event => {\n            event.preventDefault();\n            const { view } = this.editor;\n            const hadFocus = view.hasFocus();\n            const { tr } = view.state;\n            const { top, left } = event.target.getBoundingClientRect();\n            const result = view.posAtCoords({ top, left });\n            if (result) {\n                const node = view.state.doc.nodeAt(result.inside);\n                if (node) {\n                    const endOfHeadingPos = result.inside + node.nodeSize;\n                    const $pos = view.state.doc.resolve(endOfHeadingPos);\n                    const collapsed = !node.attrs.collapsed;\n                    if (collapsed && view.state.selection.to > endOfHeadingPos) {\n                        tr.setSelection(prosemirror_state_1.Selection.near($pos, -1));\n                    }\n                    const transaction = tr.setNodeMarkup(result.inside, undefined, Object.assign(Object.assign({}, node.attrs), { collapsed }));\n                    const persistKey = headingToSlug_1.headingToPersistenceKey(node, this.editor.props.id);\n                    if (collapsed) {\n                        localStorage === null || localStorage === void 0 ? void 0 : localStorage.setItem(persistKey, \"collapsed\");\n                    }\n                    else {\n                        localStorage === null || localStorage === void 0 ? void 0 : localStorage.removeItem(persistKey);\n                    }\n                    view.dispatch(transaction);\n                    if (hadFocus) {\n                        view.focus();\n                    }\n                }\n            }\n        };\n        this.handleCopyLink = event => {\n            const anchor = event.currentTarget.parentNode.parentNode.previousSibling;\n            if (!anchor.className.includes(this.className)) {\n                throw new Error(\"Did not find anchor as previous sibling of heading\");\n            }\n            const hash = `#${anchor.id}`;\n            const urlWithoutHash = window.location.href.split(\"#\")[0];\n            copy_to_clipboard_1.default(urlWithoutHash + hash);\n            if (this.options.onShowToast) {\n                this.options.onShowToast(this.options.dictionary.linkCopied, types_1.ToastType.Info);\n            }\n        };\n    }\n    get name() {\n        return \"heading\";\n    }\n    get defaultOptions() {\n        return {\n            levels: [1, 2, 3, 4],\n            collapsed: undefined,\n        };\n    }\n    get schema() {\n        return {\n            attrs: {\n                level: {\n                    default: 1,\n                },\n                collapsed: {\n                    default: undefined,\n                },\n            },\n            content: \"inline*\",\n            group: \"block\",\n            defining: true,\n            draggable: false,\n            parseDOM: this.options.levels.map(level => ({\n                tag: `h${level}`,\n                attrs: { level },\n                contentElement: \".heading-content\",\n            })),\n            toDOM: node => {\n                const anchor = document.createElement(\"button\");\n                anchor.innerText = \"#\";\n                anchor.type = \"button\";\n                anchor.className = \"heading-anchor\";\n                anchor.addEventListener(\"click\", event => this.handleCopyLink(event));\n                const fold = document.createElement(\"button\");\n                fold.innerText = \"\";\n                fold.innerHTML =\n                    '<svg fill=\"currentColor\" width=\"12\" height=\"24\" viewBox=\"6 0 12 24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.23823905,10.6097108 L11.207376,14.4695888 L11.207376,14.4695888 C11.54411,14.907343 12.1719566,14.989236 12.6097108,14.652502 C12.6783439,14.5997073 12.7398293,14.538222 12.792624,14.4695888 L15.761761,10.6097108 L15.761761,10.6097108 C16.0984949,10.1719566 16.0166019,9.54410997 15.5788477,9.20737601 C15.4040391,9.07290785 15.1896811,9 14.969137,9 L9.03086304,9 L9.03086304,9 C8.47857829,9 8.03086304,9.44771525 8.03086304,10 C8.03086304,10.2205442 8.10377089,10.4349022 8.23823905,10.6097108 Z\" /></svg>';\n                fold.type = \"button\";\n                fold.className = `heading-fold ${node.attrs.collapsed ? \"collapsed\" : \"\"}`;\n                fold.addEventListener(\"mousedown\", event => this.handleFoldContent(event));\n                return [\n                    `h${node.attrs.level + (this.options.offset || 0)}`,\n                    [\n                        \"span\",\n                        {\n                            contentEditable: false,\n                            class: `heading-actions ${node.attrs.collapsed ? \"collapsed\" : \"\"}`,\n                        },\n                        anchor,\n                        fold,\n                    ],\n                    [\n                        \"span\",\n                        {\n                            class: \"heading-content\",\n                        },\n                        0,\n                    ],\n                ];\n            },\n        };\n    }\n    toMarkdown(state, node) {\n        state.write(state.repeat(\"#\", node.attrs.level) + \" \");\n        state.renderInline(node);\n        state.closeBlock(node);\n    }\n    parseMarkdown() {\n        return {\n            block: \"heading\",\n            getAttrs: (token) => ({\n                level: +token.tag.slice(1),\n            }),\n        };\n    }\n    commands({ type, schema }) {\n        return (attrs) => {\n            return toggleBlockType_1.default(type, schema.nodes.paragraph, attrs);\n        };\n    }\n    keys({ type, schema }) {\n        const options = this.options.levels.reduce((items, level) => (Object.assign(Object.assign({}, items), {\n            [`Shift-Ctrl-${level}`]: toggleBlockType_1.default(type, schema.nodes.paragraph, { level }),\n        })), {});\n        return Object.assign(Object.assign({}, options), { Backspace: backspaceToParagraph_1.default(type), Enter: splitHeading_1.default(type) });\n    }\n    get plugins() {\n        const getAnchors = doc => {\n            const decorations = [];\n            const previouslySeen = {};\n            doc.descendants((node, pos) => {\n                if (node.type.name !== this.name)\n                    return;\n                const slug = headingToSlug_1.default(node);\n                let id = slug;\n                if (previouslySeen[slug] > 0) {\n                    id = headingToSlug_1.default(node, previouslySeen[slug]);\n                }\n                previouslySeen[slug] =\n                    previouslySeen[slug] !== undefined ? previouslySeen[slug] + 1 : 1;\n                decorations.push(prosemirror_view_1.Decoration.widget(pos, () => {\n                    const anchor = document.createElement(\"a\");\n                    anchor.id = id;\n                    anchor.className = this.className;\n                    return anchor;\n                }, {\n                    side: -1,\n                    key: id,\n                }));\n            });\n            return prosemirror_view_1.DecorationSet.create(doc, decorations);\n        };\n        const plugin = new prosemirror_state_1.Plugin({\n            state: {\n                init: (config, state) => {\n                    return getAnchors(state.doc);\n                },\n                apply: (tr, oldState) => {\n                    return tr.docChanged ? getAnchors(tr.doc) : oldState;\n                },\n            },\n            props: {\n                decorations: state => plugin.getState(state),\n            },\n        });\n        return [plugin];\n    }\n    inputRules({ type }) {\n        return this.options.levels.map(level => prosemirror_inputrules_1.textblockTypeInputRule(new RegExp(`^(#{1,${level}})\\\\s$`), type, () => ({\n            level,\n        })));\n    }\n}\nexports.default = Heading;\n"]},"metadata":{},"sourceType":"script"}